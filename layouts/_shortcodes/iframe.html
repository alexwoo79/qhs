{{- /*
Shortcode to include an iframe with fullscreen capability.
自动适配 baseURL，避免路径错误。

@param {string} url The URL to embed in the iframe. (Alias: src)
@param {string} width (Optional) The width of the iframe.
@param {string} height (Optional) The height of the iframe.
@param {string} title (Optional) The title attribute for the iframe.
@param {bool} nested (Optional) Whether this is a nested iframe.
*/ -}}

{{- $url := or (.Get "url") (.Get "src") -}}
{{- $width := .Get "width" | default "100%" -}}
{{- $height := .Get "height" | default "32rem" -}}
{{- $title := .Get "title" | default "Embedded Content" -}}
{{- $ordinal := .Ordinal -}}
{{- $isNested := .Get "nested" | default false -}}

{{- /* 如果 url 是站内资源（以 / 开头），用 relURL 拼接 */ -}}
{{- if $url -}}
  {{- if or (hasPrefix $url "http://") (hasPrefix $url "https://") (hasPrefix $url "//") -}}
    {{- /* 外部链接，直接使用 */ -}}
    {{- $url = $url | safeURL -}}
  {{- else -}}
    {{- /* 站内资源，转成绝对路径再用 relURL */ -}}
    {{- if not (hasPrefix $url "/") -}}
      {{- $url = printf "/%s" $url -}}
    {{- end -}}
    {{- $url = $url | relURL | safeURL -}}
  {{- end -}}
{{- else -}}
  {{- errorf "iframe shortcode requires 'url' or 'src' parameter: %s" .Position -}}
{{- end -}}

<div class="hextra-iframe" id="hextra-iframe-{{ $ordinal }}" data-nested="{{ $isNested }}">
  <button class="hextra-iframe-fullscreen-btn hextra-btn"
          onclick="toggleIframeFullscreen('{{ $ordinal }}')"
          title="全屏显示">
    ⛶ 全屏
  </button>
  <iframe src="{{ $url }}"
          width="{{ $width }}"
          height="{{ $height }}"
          frameborder="0"
          allowfullscreen
          title="{{ $title }}"
          sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
</div>

<style>
.hextra-iframe {
  position: relative;
}
.hextra-iframe-fullscreen-btn {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  z-index: 10;
}
.hextra-iframe.fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 9999;
  background: #fff;
}
</style>

<script>
function toggleIframeFullscreen(ordinal) {
  const container = document.getElementById('hextra-iframe-' + ordinal);
  if (container.classList.contains('fullscreen')) {
    container.classList.remove('fullscreen');
    document.body.style.overflow = '';
  } else {
    container.classList.add('fullscreen');
    document.body.style.overflow = 'hidden';
  }
}
</script>